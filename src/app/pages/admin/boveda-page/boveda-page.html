<div class="p-4">
  <h1 class="text-2xl font-semibold text-gray-800 mb-6">Bóveda</h1>

  @if (loading) {
    <div class="flex justify-center items-center py-8">
      <p class="text-gray-600">Cargando información de la bóveda...</p>
    </div>
  } @else if (error) {
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
      <p class="text-red-600">{{ error }}</p>
    </div>
  } @else {
    <!-- Información de la bóveda -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
        <h3 class="text-sm font-medium text-gray-500 mb-1">Dinero Total (Teórico)</h3>
        <p class="text-2xl font-semibold text-gray-900">S/. {{ dineroTotal | number:'1.2-2' }}</p>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
        <h3 class="text-sm font-medium text-gray-500 mb-1">Movimientos Totales</h3>
        <p class="text-2xl font-semibold text-gray-900">{{ movimientosTotales }}</p>
      </div>
    </div>

    <!-- Formulario para crear movimiento -->
    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6 shadow-sm">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Nuevo Movimiento</h2>
      
      <form [formGroup]="movimientoForm" (ngSubmit)="onSubmit()" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Tipo de Movimiento -->
          <div class="w-full flex flex-col gap-1">
            <label for="tipoMovimiento" class="text-sm font-medium text-gray-700">Tipo de Movimiento</label>
            <select
              id="tipoMovimiento"
              formControlName="tipoMovimientoBoveda"
              class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 placeholder-gray-400
                     focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/40 transition-colors duration-200"
            >
              <option value="">Seleccionar</option>
              <option value="INGRESO">INGRESO</option>
              <option value="RETIRO">RETIRO</option>
            </select>
            @if (movimientoForm.get('tipoMovimientoBoveda')?.invalid && movimientoForm.get('tipoMovimientoBoveda')?.touched) {
              <div class="text-xs text-red-500">Este campo es requerido</div>
            }
          </div>

          <!-- Monto -->
          <app-input
            label="Monto de Dinero"
            id="monto"
            type="number"
            placeholder="0.00"
            inGroupName="monto"
            [minlength]="null"
            [maxlength]="null">
          </app-input>
        </div>

        <!-- Motivo -->
        <div class="w-full flex flex-col gap-1">
          <label for="motivo" class="text-sm font-medium text-gray-700">Motivo</label>
          <textarea
            id="motivo"
            formControlName="motivo"
            rows="3"
            placeholder="Ingrese el motivo del movimiento"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-gray-900 placeholder-gray-400
                   focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/40 transition-colors duration-200"
          ></textarea>
          @if (movimientoForm.get('motivo')?.invalid && movimientoForm.get('motivo')?.touched) {
            <div class="text-xs text-red-500">Este campo es requerido</div>
          }
        </div>

        <div class="flex justify-end">
          <app-button type="submit" [disabled]="submitting || movimientoForm.invalid">
            {{ submitting ? 'Creando...' : 'Crear Movimiento' }}
          </app-button>
        </div>
      </form>
    </div>

    <!-- Listado de movimientos -->
    <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
      <div class="p-4 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800">Listado de Movimientos</h2>
      </div>
      
      @if (movimientos.length === 0) {
        <div class="p-8 text-center">
          <p class="text-gray-500">No hay movimientos registrados</p>
        </div>
      } @else {
        <app-table>
          <ng-container table-header>
            <tr>
              <th class="px-4 py-3 font-medium">Fecha</th>
              <th class="px-4 py-3 font-medium">Usuario ID</th>
              <th class="px-4 py-3 font-medium">Tipo</th>
              <th class="px-4 py-3 font-medium">Monto</th>
              <th class="px-4 py-3 font-medium">Motivo</th>
            </tr>
          </ng-container>
          <ng-container table-body>
            @for (movimiento of movimientos; track movimiento.idMovimiento) {
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-3">
                  @if (movimiento.fecha) {
                    {{ movimiento.fecha | date:'short' }}
                  } @else {
                    -
                  }
                </td>
                <td class="px-4 py-3">{{ movimiento.usuarioId }}</td>
                <td class="px-4 py-3">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                        [class.bg-green-100]="movimiento.tipoMovimientoBoveda === 'INGRESO'"
                        [class.text-green-800]="movimiento.tipoMovimientoBoveda === 'INGRESO'"
                        [class.bg-red-100]="movimiento.tipoMovimientoBoveda === 'RETIRO'"
                        [class.text-red-800]="movimiento.tipoMovimientoBoveda === 'RETIRO'">
                    {{ movimiento.tipoMovimientoBoveda }}
                  </span>
                </td>
                <td class="px-4 py-3 font-medium">S/. {{ movimiento.monto | number:'1.2-2' }}</td>
                <td class="px-4 py-3">{{ movimiento.motivo }}</td>
              </tr>
            }
          </ng-container>
        </app-table>
      }
    </div>
  }
</div>
